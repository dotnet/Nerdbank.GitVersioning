steps:
- checkout: none # skip checking out the default repository resource
- task: DownloadBuildArtifacts@0
  displayName: Download Build Artifacts
  inputs:
    artifactName: deployables
    downloadPath: $(System.DefaultWorkingDirectory)
- task: Bash@3
  displayName: Consume NB.GV from .NET Core build
  inputs:
    targetType: inline
    failOnStderr: true
    script: |
      PkgFileName=$(find deployables/*nupkg -printf "%f\n")
      NBGV_NuGetPackageVersion=$([[ $NBGV_NuGetPackageVersion =~ Nerdbank.GitVersioning\.(.*)\.nupkg ]] && echo "${BASH_REMATCH[1]}")
      echo "Using Nerdbank.GitVersioning $NBGV_NuGetPackageVersion in a new .NET Core project"
      dotnet new classlib -o lib
      dotnet add lib package nerdbank.gitversioning -s deployables -v $NBGV_NuGetPackageVersion
      dotnet build lib
